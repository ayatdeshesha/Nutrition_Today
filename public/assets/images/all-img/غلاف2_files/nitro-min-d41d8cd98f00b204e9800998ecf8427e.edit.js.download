(function(e){e(window).load(function(){var t=autosize(e("textarea.autosize"));function a(e,t,a){return a.indexOf(e)===t}var n=new wp.api.collections.Tags;var i=new RegExp("([^,]+)$");var r;function o(t=null){if(t==null){t=e(document)}t.find(".autocomplete-tags").autocomplete({source:function(e,t){try{r.abort()}catch(e){}var a=e.term;var o=a.match(i);if(o&&o[0].trim()){r=n.fetch({data:{search:o[0].trim()}});r.done(function(e){names=[];var n="";if(o[0]!=a){n=a.replace(i,"")+" "}for(var r=e.length-1;r>=0;r--){var s=e[r].name;names.push({label:e[r].name,value:n+s})}t(names)});r.fail(function(){t([])})}else{t()}},minLength:1})}o();e(document).on("autocomplete-tags",".autocomplete-tags-event",function(t){t.stopPropagation();o(e(this))});function s(a=null){if(a==null){a=e(document)}a.find(".tags-input").each(function(){var a=e(this);var n=e("#"+a.data("for"));if(!n.length){return}var i=n.find(".ui-input");if(i.length!=1){console.error('Exactly 1 element with class "ui-input" needed!',i);return}var r=n.find(".ui-to-copy");if(!r.length){console.error('element with class "ui-to-copy" needed!',r);return}n.css("display","");a.css("display","none");var o=[];var s=v(a.val());var u={};var f=function(e){if(u[e])return;var t=r.clone();t.find(".text").text(e);t.find(".remove").data("tag",e);t.removeClass("ui-to-copy");u[e]=t;t.css("display","");r.before(t);o.push(e)};var l=function(e){if(!u[e])return;var t=u[e];t.remove();u[e]=null;o.splice(o.indexOf(e),1);c()};var c=function(){var e=[];var t=o.join(",");if(t){e.push(t)}var n=i.val();if(n){e.push(n)}a.val(e.join(","))};e.each(s,function(e,t){f(t);c()});i.on("keydown",function(a){if(a.keyCode!=13)return;a.preventDefault();var n=v(i.val());e.each(n,function(e,t){f(t)});i.val("");i.trigger("change");c();autosize.update(t);return false});i.on("change",c);n.on("click",".remove",function(t){t.preventDefault();var a=e(this).data("tag");l(a)})})}s();e(document).on("tags-ui",".tags-ui-event",function(t){t.stopPropagation();s(e(this))});var u=false;function f(t,a){e.ajax({url:wpApiSettings.root+"wp/v2/tags",method:"GET",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",wpApiSettings.nonce)},data:{search:t}}).done(function(e){var n=null;for(var i=e.length-1;i>=0;i--){if(e[i].name==t){n=e[i];break}}a(n)})}function l(t,a){e.ajax({url:wpApiSettings.root+"wp/v2/tags",method:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",wpApiSettings.nonce)},data:{name:t}}).done(function(e){a(e)}).fail(function(){f(t,a)})}function c(e,t){f(e,function(a){if(a){t(a)}else{l(e,function(e){t(e)})}})}function d(t,a,n,i){e.ajax({url:wpApiSettings.root+"wp/v2/photo/"+t,method:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",wpApiSettings.nonce)},data:a}).done(n).always(i)}function v(t){var n=t.split(",");var i=[];e.each(n,function(e,t){t=t.trim().toLowerCase();if(t){i.push(t)}});return i.filter(a)}e("form input[type=submit]").click(function(){e("input[type=submit]",e(this).parents("form")).removeAttr("clicked");e(this).attr("clicked","true")});e(".edit-photo-ajax").submit(function(t){t.preventDefault();var a=e("input[type=submit][clicked=true]").attr("name");if(u){return}var n=e(this);var i=n.find('[name="photo_id"]');if(i.length==0){u=false;return}var r=i.val();var o=n.find("input, select, button, textarea");var s={};var f=n.find('[name="post_title"]');if(f.length!=0){s.title=f.val()}if(a=="publish"){s.status="publish"}var l=n.find('[name="post_tags"]');if(l.length!=0){var p=[];var h=v(l.val());var g=h.length;if(g){e.each(h,function(e,t){c(t,function(e){if(e){p.push(e.id)}else{g-=1}if(p.length==g){s.tags=p;d(r,s,function(){alert("Changes saved!")},function(){o.prop("disabled",false);u=false})}})})}else{d(r,s,function(){alert("Changes saved!")},function(){o.prop("disabled",false);u=false})}}else{d(r,s,function(){if(a=="publish"){alert("Changes saved and published!")}else{alert("Changes saved!")}},function(){o.prop("disabled",false);u=false})}});e(".img-update-area").each(function(){var t=e(this);var a=t.find(".img-update-input");var n=t.find(".img-update-preview");var i=t.find(".img-update-error");var r=t.find(".img-size-error");var o=a.attr("accept");var s=a.data("min_w");var u=a.data("min_h");function f(e){if(e.files&&e.files[0]){i.hide();r.hide();var f=e.files[0];if(f.type){if(o.search(f.type)<0){if(i.length){i.show()}return}}n[0].onload=function(){var e=this.naturalWidth;var i=this.naturalHeight;if(s&&e<s||u&&i<u){n.attr("src","");a.val("");t.addClass("dropdown-empty");t.removeClass("loading");r.show()}};var l=new FileReader;a.attr("src","");l.onloadstart=function(e){t.addClass("loading")};l.onload=function(e){n.attr("src",e.target.result);t.removeClass("dropdown-empty");setTimeout(function(){t.removeClass("loading")},1e3)};l.readAsDataURL(f)}}f(a[0]);a.change(function(){f(this)})});e(document).on("keydown","input, textarea",function(e){if(e.keyCode==83&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)){e.preventDefault();return false}});function p(){var t=e(".toggle-class-wrap");t.each(function(){var t=e(this);var a=t.find(".toggle-class");t.addClass("active");function n(){a.each(function(){var a=e(this);var n=a.data("class");if(a.is(":checked")){t.addClass(n)}else{t.removeClass(n)}})}n();a.change(n)})}p()})})(jQuery);